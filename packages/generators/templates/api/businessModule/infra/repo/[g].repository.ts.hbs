import { Injectable } from '@nestjs/common'
import { EntityManager } from 'typeorm'
import { LogContextClass } from '@/common/deco'
import { LoggingService } from '@/common/infra'
import { CrudRepositoryTemplate } from '@/common/template'
import { I{{pascalCase moduleName}}Repository, {{pascalCase moduleName}}Entity } from '../../domain'
{{!-- 树特有 --}}
{{#if hasTree}}
import type { FindOptionsRelations } from 'typeorm'
{{/if}}

/** {{zhName}}仓库实现 */
@Injectable()
@LogContextClass()
export class {{pascalCase moduleName}}Repository extends CrudRepositoryTemplate<{{pascalCase moduleName}}Entity> implements I{{pascalCase moduleName}}Repository {
  constructor(
    protected readonly em: EntityManager,
    protected readonly loggingService: LoggingService,
  ) {
    super({{pascalCase moduleName}}Entity, em, loggingService)
  }

  {{!-- 树特有 --}}
  {{#if hasTree}}
  getDefaultRelations(): FindOptionsRelations<{{pascalCase moduleName}}Entity> {
    return {
      ancestorNodes: true,
      descendantNodes: true,
    }
  }
  {{/if}}
}
